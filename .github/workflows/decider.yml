name: Decider Workflow

on:
  workflow_call:
    inputs:
      course_id:
        required: true
        type: string
      available_assignments:
        required: true
        type: string
      student_id:
        required: true
        type: string
      kmom_paths:
        required: true
        type: string

jobs:

  on-tag:
    if: startsWith(github.ref, 'refs/tags/')
    uses: bth-python/utils/.github/workflows/tester.yml@dev
    with:
      kmom_paths: ${{ inputs.kmom_paths }}
    secrets: inherit

  # on-pr-merged:
  #   if: ${{ inputs.event_name == 'pull_request' && fromJson(inputs.event).pull_request.merged == true && github.base_ref != 'bth/submit/test-gitconfig' }}
  #   uses: bth-python/utils/.github/workflows/on_merge.yml@dev
  #   with:
  #     course_id: ${{ inputs.course_id }}
  #     student_id: ${{ inputs.student_id }}
  #     available_assignments: ${{ inputs.available_assignments }}
  #     event: ${{ inputs.event }}
  #   secrets: inherit

  # on-pr-closed:
  #   if: ${{ inputs.event_name == 'pull_request' && inputs.pr_action == 'closed' && !fromJson(inputs.event).pull_request.merged == true && github.base_ref != 'bth/submit/test-gitconfig' }}
  #   uses: bth-python/utils/.github/workflows/closed_pr.yml@dev
  #   with:
  #     pr_action: ${{ inputs.pr_action }}
  #     event: ${{ inputs.event }}
  #     course_id: ${{ inputs.course_id }}
  #     available_assignments: ${{ inputs.available_assignments }}
  #     student_id: ${{ inputs.student_id }}
  #   secrets: inherit

  on-pr-opened:
    if: ${{ github.event_name == 'pull_request' && github.event.action == 'opened' && github.base_ref != 'bth/submit/test-gitconfig'}}
    uses: bth-python/utils/.github/workflows/submit_to_canvas.yml@dev
    with:
      course_id: ${{ inputs.course_id }}
      available_assignments: ${{ inputs.available_assignments }}
      student_id: ${{ inputs.student_id }}
    secrets: inherit

  # on-requested-change:
  #   if: ${{ inputs.event_name == 'pull_request_review' && inputs.review_state == 'changes_requested' && github.base_ref != 'bth/submit/test-gitconfig' }}
  #   uses: bth-python/utils/.github/workflows/need_fix.yml@dev
  #   with:
  #     event: ${{ inputs.event }}
  #     course_id: ${{ inputs.course_id }}
  #     student_id: ${{ inputs.student_id }}
  #     available_assignments: ${{ inputs.available_assignments }}
  #   secrets: inherit

  # on-pr-opened-test-gitconfig:
  #   if: ${{ inputs.event_name == 'pull_request' && inputs.pr_action == 'opened' && github.base_ref == 'bth/submit/test-gitconfig' }}
  #   uses: bth-python/utils/.github/workflows/test-gitconfig.yml@dev
  #   with:
  #     pr_action: ${{ inputs.pr_action }}
  #     event: ${{ inputs.event }}
  #     course_id: ${{ inputs.course_id }}
  #     available_assignments: ${{ inputs.available_assignments }}
  #     student_id: ${{ inputs.student_id }}
  #   secrets: inherit

  # on-other:
  #   if:
  #     ${{ !(inputs.event_name == 'pull_request' && inputs.pr_action == 'opened')
  #     && !(inputs.event_name == 'pull_request_review' && inputs.review_state == 'submitted')
  #     && !(inputs.event_name == 'push') }}
  #   uses: ./.github/workflows/workflow-for-other.yml
